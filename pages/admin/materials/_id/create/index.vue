<template>
    <div class="content-mp">
        <div class="materials">
            <v-row class="">
                <v-col class="" xs="12" sm="12" md="7" lg="7" xl="7">
                    <div style="min-width: 245px;" class=" wow animate__animated animate__zoomIn">
                        <div>
                            <b-form-group>
                                <div class="label">
                                    <span class="me-2">
                                        <svg width="15" height="14" viewBox="0 0 15 14" fill="none"
                                            xmlns="http://www.w3.org/2000/svg">
                                            <path
                                                d="M13.2289 12.7895C13.7003 12.696 13.979 12.2006 13.7285 11.7905C13.2392 10.9896 12.4885 10.2855 11.5367 9.745C10.271 9.02629 8.7203 8.63672 7.125 8.63672C5.5297 8.63672 3.97898 9.02628 2.71335 9.745C1.76146 10.2855 1.01084 10.9896 0.521527 11.7905C0.271038 12.2006 0.549732 12.696 1.02105 12.7895C5.05112 13.5886 9.19888 13.5886 13.2289 12.7895Z"
                                                fill="#FC4D32" />
                                            <path
                                                d="M11.1508 3.8309C11.1508 5.94662 9.34825 7.66174 7.12471 7.66174C4.90117 7.66174 3.09863 5.94662 3.09863 3.8309C3.09863 1.71519 4.90117 6.77534e-05 7.12471 6.77534e-05C9.34825 6.77534e-05 11.1508 1.71519 11.1508 3.8309Z"
                                                fill="#FC4D32" />
                                        </svg>
                                    </span>
                                    Gán giáo viên
                                </div>
                                <div class="w-100">
                                    <b-form-select v-model="giao_vien_id" :options="giao_vien"
                                        aria-placeholder="Chọn"></b-form-select>
                                </div>
                            </b-form-group>
                        </div>
                        <div>
                            <b-form-group>
                                <div class="label">
                                    <span class="me-2">
                                        <svg width="14" height="14" viewBox="0 0 14 14" fill="none"
                                            xmlns="http://www.w3.org/2000/svg">
                                            <path
                                                d="M12.8824 4.07404L7.36554 7.19742C7.14343 7.32347 6.86401 7.32347 6.63474 7.19742L1.11788 4.07404C0.723821 3.84994 0.623514 3.32471 0.924434 2.99557C1.13221 2.76447 1.36865 2.57538 1.61941 2.44232L5.50271 0.3414C6.33382 -0.1138 7.68079 -0.1138 8.5119 0.3414L12.3952 2.44232C12.646 2.57538 12.8824 2.77147 13.0902 2.99557C13.3768 3.32471 13.2765 3.84994 12.8824 4.07404Z"
                                                fill="#FFB761" />
                                            <path
                                                d="M6.59157 8.5003V13.2764C6.59157 13.8086 6.03988 14.1588 5.55268 13.9277C4.07674 13.2204 1.59057 11.8968 1.59057 11.8968C0.716474 11.4136 0 10.195 0 9.19361V5.58002C0 5.02677 0.594674 4.67662 1.08188 4.94974L6.23333 7.87002C6.44827 8.00308 6.59157 8.24119 6.59157 8.5003Z"
                                                fill="#FFB761" />
                                            <path
                                                d="M7.4082 8.5003V13.2764C7.4082 13.8086 7.95989 14.1588 8.44709 13.9277C9.92303 13.2204 12.4092 11.8968 12.4092 11.8968C13.2833 11.4136 13.9998 10.195 13.9998 9.19361V5.58002C13.9998 5.02677 13.4051 4.67662 12.9179 4.94974L7.76644 7.87002C7.5515 8.00308 7.4082 8.24119 7.4082 8.5003Z"
                                                fill="#FFB761" />
                                        </svg>

                                    </span>
                                    Số lượng
                                </div>
                                <div class="w-100">
                                    <input v-model="so_luong" placeholder="Nhập số lượng" type="number"
                                        class="form-control input-text" />
                                </div>
                            </b-form-group>
                        </div>
                        <div>
                            <b-form-group>
                                <div class="label">
                                    <span class="me-2">
                                        <svg width="14" height="14" viewBox="0 0 14 14" fill="none"
                                            xmlns="http://www.w3.org/2000/svg">
                                            <path
                                                d="M13.1838 6.87422L13.0768 6.72022C12.8895 6.48222 12.6688 6.29322 12.4146 6.15321C12.0735 5.95021 11.6856 5.84521 11.2843 5.84521H2.95724C2.55594 5.84521 2.1747 5.95021 1.8269 6.15321C1.56605 6.30022 1.33196 6.50322 1.138 6.75522C0.756757 7.26622 0.576171 7.89622 0.636366 8.52622L0.883837 11.7952C0.970786 12.7822 1.08449 14.0002 3.20471 14.0002H11.0435C13.1637 14.0002 13.2707 12.7822 13.3644 11.7882L13.6119 8.53322C13.672 7.94522 13.5249 7.35722 13.1838 6.87422ZM8.72264 10.7382H5.51889C5.25805 10.7382 5.05071 10.5142 5.05071 10.2482C5.05071 9.98222 5.25805 9.75822 5.51889 9.75822H8.72264C8.98348 9.75822 9.19082 9.98222 9.19082 10.2482C9.19082 10.5212 8.98348 10.7382 8.72264 10.7382Z"
                                                fill="#4EAEEA" />
                                            <path
                                                d="M12.8173 4.34012C12.8722 4.72504 12.4426 4.98641 12.065 4.89386C11.8151 4.83262 11.5565 4.80201 11.2907 4.80201H2.95692C2.685 4.80201 2.41614 4.83564 2.15765 4.9006C1.78476 4.99432 1.3584 4.74232 1.3584 4.35783V3.262C1.3584 0.763001 2.08743 0 4.47519 0H5.26442C6.22086 0 6.52184 0.322 6.90977 0.847001L7.71237 1.967C7.87958 2.205 7.88627 2.219 8.18056 2.219H9.7724C11.7524 2.219 12.5899 2.74472 12.8173 4.34012Z"
                                                fill="#4EAEEA" />
                                        </svg>
                                    </span>
                                    Gói giáo cụ
                                </div>
                                <div class="w-100">
                                    <input v-model="code" disabled placeholder="" type="text"
                                        class="form-control input-text" />
                                </div>
                            </b-form-group>
                        </div>
                        <div>
                            <b-form-group>
                                <div class="label">
                                    <span class="me-2">
                                        <svg width="13" height="12" viewBox="0 0 13 12" fill="none"
                                            xmlns="http://www.w3.org/2000/svg">
                                            <path
                                                d="M6.125 0C2.819 0 0.125 2.694 0.125 6C0.125 9.306 2.819 12 6.125 12C9.431 12 12.125 9.306 12.125 6C12.125 2.694 9.431 0 6.125 0ZM8.735 8.142C8.651 8.286 8.501 8.364 8.345 8.364C8.267 8.364 8.189 8.346 8.117 8.298L6.257 7.188C5.795 6.912 5.453 6.306 5.453 5.772V3.312C5.453 3.066 5.657 2.862 5.903 2.862C6.149 2.862 6.353 3.066 6.353 3.312V5.772C6.353 5.988 6.533 6.306 6.719 6.414L8.579 7.524C8.795 7.65 8.867 7.926 8.735 8.142Z"
                                                fill="#00C092" />
                                        </svg>
                                    </span>
                                    Hạn hoàn trả lại giáo cụ
                                </div>
                                <div class="w-100">
                                    <input v-model="ngay_nhan" placeholder="Ngày nhận hoặc ngày bàn giao" type="date"
                                        class="form-control input-text" />
                                </div>
                            </b-form-group>
                        </div>
                        <div>
                            <b-form-group>
                                <div class="label">
                                    <span class="me-2">
                                        <svg width="13" height="12" viewBox="0 0 13 12" fill="none"
                                            xmlns="http://www.w3.org/2000/svg">
                                            <path
                                                d="M8.525 0H3.725C1.325 0 0.125 1.2 0.125 3.6V11.4C0.125 11.73 0.395 12 0.725 12H8.525C10.925 12 12.125 10.8 12.125 8.4V3.6C12.125 1.2 10.925 0 8.525 0ZM5.591 8.796C5.441 8.946 5.165 9.084 4.961 9.114L3.713 9.288C3.665 9.294 3.617 9.3 3.575 9.3C3.365 9.3 3.173 9.228 3.035 9.09C2.867 8.922 2.795 8.676 2.837 8.412L3.011 7.164C3.041 6.96 3.179 6.678 3.329 6.534L5.591 4.272C5.627 4.38 5.675 4.488 5.729 4.608C5.783 4.716 5.837 4.824 5.897 4.926C5.945 5.01 5.999 5.094 6.047 5.154C6.107 5.244 6.167 5.322 6.209 5.364C6.233 5.4 6.257 5.424 6.263 5.436C6.395 5.586 6.533 5.73 6.665 5.838C6.701 5.874 6.725 5.892 6.731 5.898C6.809 5.958 6.881 6.024 6.953 6.066C7.031 6.126 7.115 6.18 7.199 6.228C7.301 6.288 7.409 6.348 7.523 6.402C7.637 6.456 7.745 6.498 7.853 6.534L5.591 8.796ZM8.855 5.538L8.387 6.006C8.357 6.036 8.315 6.054 8.273 6.054C8.261 6.054 8.237 6.054 8.225 6.048C7.193 5.754 6.371 4.932 6.077 3.9C6.059 3.846 6.077 3.786 6.119 3.744L6.593 3.27C7.367 2.496 8.099 2.514 8.855 3.27C9.239 3.654 9.431 4.026 9.425 4.41C9.425 4.788 9.239 5.154 8.855 5.538Z"
                                                fill="#EB1B24" />
                                        </svg>
                                    </span>
                                    Ghi chú
                                </div>
                                <div class="w-100">
                                    <b-form-textarea id="textarea" v-model="ghi_chu" placeholder="Nhập..." rows="3"
                                        max-rows="6"></b-form-textarea>
                                </div>
                            </b-form-group>
                        </div>

                        <div class="mt-7">
                            <form id="form" @submit="send_data">
                                <button-component typeBtn="submit">
                                    Lưu
                                </button-component>
                            </form>
                        </div>

                    </div>
                </v-col>

            </v-row>
        </div>
    </div>
</template>

<script>
import SUNEDITOR from 'suneditor'
import plugins from 'suneditor/src/plugins'
import 'suneditor/dist/css/suneditor.min.css'
import api from '@/store/axios'
import Swal from 'sweetalert2'
import toastr from 'toastr';

export default {
    layout: 'admin',
    data() {
        return {
            title: {
                name: 'Tạo bàn giao',
                previous: '/admin/materials'
            },
            code: null,
            so_luong_tong: null,
            so_luong_ton: null,
            ghi_chu: null,
            file: null,
            giao_vien_id: null,
            giao_vien: null,
            so_luong: 1,
            data: null,
            code: null,
            ngay_nhan: null,
            clearFiles() {
                this.$refs['file-input'].reset()
            }
        };
    },
    computed: {
        token() {
            const storedUser = JSON.parse(localStorage.getItem('user'));
            return storedUser.auth_key
        },
        id() {
            return this.$route.params.id
        },
    },
    methods: {
        async load_data() {
            await api.get('thong-bao/danh-sach-giao-vien?tuKhoa=', {
                'Content-Type': 'multipart/form-data',
                Authorization: 'Bearer ' + this.token
            }).then(res => {
                this.giao_vien = res?.data?.data.map(item => {
                    return {
                        value: item?.id,
                        text: item?.hoten ?? (item?.id + ' - Chưa cập nhật')
                    };
                })
                this.giao_vien_id = this.giao_vien[0].value
            })

            await api.get('giao-cu/chi-tiet?id=' + this.id, {
                'Content-Type': 'multipart/form-data',
                Authorization: 'Bearer ' + this.token
            }).then(res => {
                const user = res?.data?.data
                this.data = user
                this.code = user?.code
            })
        },
        async send_data(event) {
            event.preventDefault();
            const formData = new FormData()
            formData.append('giao_vien_id', this.giao_vien_id)
            formData.append('giao_cu_id', this.id)
            formData.append('so_luong', this.so_luong)
            formData.append('ghi_chu', this.ghi_chu)
            formData.append('ngay_nhan', this.ngay_nhan)

            await api.post('giao-cu/tao-moi-ban-giao', formData, {
                'Content-Type': 'multipart/form-data',
                Authorization: 'Bearer ' + this.token
            }).then(res => {
                if (res?.status == 200) {
                    toastr.success(res?.data?.message);
                    this.$router.push('/admin/materials/detail/' + this.id);
                }
            })
        }
    },
    mounted() {
        this.load_data()
        this.$store.dispatch('title/set_title', this.title);
    },
    components: {}
}
</script>

<style lang="scss" scoped>
.btn-banner-save {
    transition: 0.3s;
    cursor: pointer;
    // &:hover {
    //     stroke: rgb(30, 161, 236);
    //     transform: scale(1.05);
    // }
}

.btn-banner-delete {
    cursor: pointer;
    transition: 0.3s;
    // &:hover {
    //     stroke: rgb(238, 50, 50);
    //     transform: scale(1.05);
    // }
}

.card-img {
    padding: 10px;
    border-radius: 10px;
    border: 1px solid #E5E5E5;
    background: #FFF;
    display: flex;
    justify-content: space-between;
}

.box-img {

    width: 104px;
    height: 72px;

    img {
        width: 100%;
        height: 100%;
        object-fit: cover;
    }
}

.materials {
    i {
        color: #2D2D2D;
        font-family: SVN-Gilroy;
        font-size: 14px;
        font-style: italic;
        font-weight: 400;
        line-height: normal;
        margin-left: 7px;
    }

    .label {
        color: #2D2D2D;
        font-family: SVN-Gilroy;
        font-size: 14px;
        font-style: normal;
        font-weight: 600;
        line-height: normal;
        display: flex;
        align-items: center;
        margin-bottom: 10px;
    }

    @media (max-width: 600px) {
        .btn-type {
            padding: 8px 25px;
            margin-right: 7px;
            margin-bottom: 7px;
        }
    }
}</style>