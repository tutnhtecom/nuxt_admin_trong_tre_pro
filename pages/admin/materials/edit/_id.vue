<template>
    <div class="content-mp">
        <div class="materials">
            <v-row class="">
                <v-col class="" xs="12" sm="12" md="7" lg="7" xl="7">
                    <div style="min-width: 245px;" class=" wow animate__animated animate__zoomIn">
                        <div>
                            <b-form-group>
                                <div class="label">
                                    <span class="me-2">
                                        <svg width="14" height="14" viewBox="0 0 14 14" fill="none"
                                            xmlns="http://www.w3.org/2000/svg">
                                            <path
                                                d="M13.0588 6.87422L12.9518 6.72022C12.7645 6.48222 12.5438 6.29322 12.2896 6.15321C11.9485 5.95021 11.5606 5.84521 11.1593 5.84521H2.83224C2.43094 5.84521 2.0497 5.95021 1.7019 6.15321C1.44105 6.30022 1.20696 6.50322 1.013 6.75522C0.631757 7.26622 0.451171 7.89622 0.511366 8.52622L0.758837 11.7952C0.845786 12.7822 0.959489 14.0002 3.07971 14.0002H10.9185C13.0387 14.0002 13.1457 12.7822 13.2394 11.7882L13.4869 8.53322C13.547 7.94522 13.3999 7.35722 13.0588 6.87422ZM8.59764 10.7382H5.39389C5.13305 10.7382 4.92571 10.5142 4.92571 10.2482C4.92571 9.98222 5.13305 9.75822 5.39389 9.75822H8.59764C8.85848 9.75822 9.06582 9.98222 9.06582 10.2482C9.06582 10.5212 8.85848 10.7382 8.59764 10.7382Z"
                                                fill="#FC4D32" />
                                            <path
                                                d="M12.6923 4.34012C12.7472 4.72504 12.3176 4.98641 11.94 4.89386C11.6901 4.83262 11.4315 4.80201 11.1657 4.80201H2.83192C2.56 4.80201 2.29114 4.83564 2.03265 4.9006C1.65976 4.99432 1.2334 4.74232 1.2334 4.35783V3.262C1.2334 0.763001 1.96243 0 4.35019 0H5.13942C6.09586 0 6.39684 0.322 6.78477 0.847001L7.58737 1.967C7.75458 2.205 7.76127 2.219 8.05556 2.219H9.6474C11.6274 2.219 12.4649 2.74472 12.6923 4.34012Z"
                                                fill="#FC4D32" />
                                        </svg>
                                    </span>
                                    Chủ đề thông báo
                                </div>
                                <div class="w-100">
                                    <input v-model="code" type="text" class="form-control input-text" />
                                </div>
                            </b-form-group>
                        </div>
                        <div>
                            <b-form-group>
                                <div class="label">
                                    <span class="me-2">
                                        <svg width="14" height="14" viewBox="0 0 14 14" fill="none"
                                            xmlns="http://www.w3.org/2000/svg">
                                            <path
                                                d="M12.8824 4.07404L7.36554 7.19742C7.14343 7.32347 6.86401 7.32347 6.63474 7.19742L1.11788 4.07404C0.723821 3.84994 0.623514 3.32471 0.924434 2.99557C1.13221 2.76447 1.36865 2.57538 1.61941 2.44232L5.50271 0.3414C6.33382 -0.1138 7.68079 -0.1138 8.5119 0.3414L12.3952 2.44232C12.646 2.57538 12.8824 2.77147 13.0902 2.99557C13.3768 3.32471 13.2765 3.84994 12.8824 4.07404Z"
                                                fill="#FFB761" />
                                            <path
                                                d="M6.59157 8.5003V13.2764C6.59157 13.8086 6.03988 14.1588 5.55268 13.9277C4.07674 13.2204 1.59057 11.8968 1.59057 11.8968C0.716474 11.4136 0 10.195 0 9.19361V5.58002C0 5.02677 0.594674 4.67662 1.08188 4.94974L6.23333 7.87002C6.44827 8.00308 6.59157 8.24119 6.59157 8.5003Z"
                                                fill="#FFB761" />
                                            <path
                                                d="M7.4082 8.5003V13.2764C7.4082 13.8086 7.95989 14.1588 8.44709 13.9277C9.92303 13.2204 12.4092 11.8968 12.4092 11.8968C13.2833 11.4136 13.9998 10.195 13.9998 9.19361V5.58002C13.9998 5.02677 13.4051 4.67662 12.9179 4.94974L7.76644 7.87002C7.5515 8.00308 7.4082 8.24119 7.4082 8.5003Z"
                                                fill="#FFB761" />
                                        </svg>

                                    </span>
                                    Số lượng tổng
                                </div>
                                <div class="w-100">
                                    <input v-model="so_luong_tong" type="text" class="form-control input-text" />
                                </div>
                            </b-form-group>
                        </div>
                        <div>
                            <b-form-group>
                                <div class="label">
                                    <span class="me-2">
                                        <svg width="16" height="16" viewBox="0 0 16 16" fill="none"
                                            xmlns="http://www.w3.org/2000/svg">
                                            <path
                                                d="M10.5197 1.3335H5.47967C2.95967 1.3335 2.33301 2.00683 2.33301 4.6935V12.2002C2.33301 13.9735 3.30634 14.3935 4.48634 13.1268L4.49301 13.1202C5.03967 12.5402 5.87301 12.5868 6.34634 13.2202L7.01967 14.1202C7.55967 14.8335 8.43301 14.8335 8.97301 14.1202L9.64634 13.2202C10.1263 12.5802 10.9597 12.5335 11.5063 13.1202C12.693 14.3868 13.6597 13.9668 13.6597 12.1935V4.6935C13.6663 2.00683 13.0397 1.3335 10.5197 1.3335ZM9.89301 6.66016L9.55967 7.00016H9.55301L7.53301 9.02016C7.44634 9.10683 7.26634 9.20016 7.13967 9.2135L6.23967 9.34683C5.91301 9.3935 5.68634 9.16016 5.73301 8.84016L5.85967 7.9335C5.87967 7.80683 5.96634 7.6335 6.05301 7.54016L8.07967 5.52016L8.41301 5.18016C8.63301 4.96016 8.87967 4.80016 9.14634 4.80016C9.37301 4.80016 9.61967 4.90683 9.89301 5.18016C10.493 5.78016 10.2997 6.2535 9.89301 6.66016Z"
                                                fill="#4EAEEA" />
                                        </svg>
                                    </span>
                                    Số tồn kho
                                </div>
                                <div class="w-100">
                                    <input v-model="so_luong_ton" type="text" class="form-control input-text" />
                                </div>
                            </b-form-group>
                        </div>
                        <div>
                            <b-form-group>
                                <div class="label">
                                    <span class="me-2">
                                        <svg width="12" height="12" viewBox="0 0 12 12" fill="none"
                                            xmlns="http://www.w3.org/2000/svg">
                                            <path
                                                d="M8.4 0H3.6C1.2 0 0 1.2 0 3.6V11.4C0 11.73 0.27 12 0.6 12H8.4C10.8 12 12 10.8 12 8.4V3.6C12 1.2 10.8 0 8.4 0ZM5.466 8.796C5.316 8.946 5.04 9.084 4.836 9.114L3.588 9.288C3.54 9.294 3.492 9.3 3.45 9.3C3.24 9.3 3.048 9.228 2.91 9.09C2.742 8.922 2.67 8.676 2.712 8.412L2.886 7.164C2.916 6.96 3.054 6.678 3.204 6.534L5.466 4.272C5.502 4.38 5.55 4.488 5.604 4.608C5.658 4.716 5.712 4.824 5.772 4.926C5.82 5.01 5.874 5.094 5.922 5.154C5.982 5.244 6.042 5.322 6.084 5.364C6.108 5.4 6.132 5.424 6.138 5.436C6.27 5.586 6.408 5.73 6.54 5.838C6.576 5.874 6.6 5.892 6.606 5.898C6.684 5.958 6.756 6.024 6.828 6.066C6.906 6.126 6.99 6.18 7.074 6.228C7.176 6.288 7.284 6.348 7.398 6.402C7.512 6.456 7.62 6.498 7.728 6.534L5.466 8.796ZM8.73 5.538L8.262 6.006C8.232 6.036 8.19 6.054 8.148 6.054C8.136 6.054 8.112 6.054 8.1 6.048C7.068 5.754 6.246 4.932 5.952 3.9C5.934 3.846 5.952 3.786 5.994 3.744L6.468 3.27C7.242 2.496 7.974 2.514 8.73 3.27C9.114 3.654 9.306 4.026 9.3 4.41C9.3 4.788 9.114 5.154 8.73 5.538Z"
                                                fill="#00C092" />
                                        </svg>

                                    </span>
                                    Ghí chú
                                </div>
                                <div class="w-100">
                                    <textarea v-model="ghi_chu" class="form-control input-text"></textarea>
                                </div>
                            </b-form-group>
                        </div>
                        <div>
                            <b-form-group>
                                <div class="label">
                                    <span class="me-2">
                                        <svg width="16" height="16" viewBox="0 0 16 16" fill="none"
                                            xmlns="http://www.w3.org/2000/svg">
                                            <path
                                                d="M1.71954 12.6735L1.70621 12.6868C1.52621 12.2935 1.41288 11.8468 1.36621 11.3535C1.41288 11.8402 1.53954 12.2802 1.71954 12.6735Z"
                                                fill="#0056B1" />
                                            <path
                                                d="M5.99975 6.91992C6.87604 6.91992 7.58642 6.20954 7.58642 5.33325C7.58642 4.45696 6.87604 3.74658 5.99975 3.74658C5.12346 3.74658 4.41309 4.45696 4.41309 5.33325C4.41309 6.20954 5.12346 6.91992 5.99975 6.91992Z"
                                                fill="#0056B1" />
                                            <path
                                                d="M10.793 1.3335H5.20634C2.77967 1.3335 1.33301 2.78016 1.33301 5.20683V10.7935C1.33301 11.5202 1.45967 12.1535 1.70634 12.6868C2.27967 13.9535 3.50634 14.6668 5.20634 14.6668H10.793C13.2197 14.6668 14.6663 13.2202 14.6663 10.7935V9.26683V5.20683C14.6663 2.78016 13.2197 1.3335 10.793 1.3335ZM13.5797 8.3335C13.0597 7.88683 12.2197 7.88683 11.6997 8.3335L8.92634 10.7135C8.40634 11.1602 7.56634 11.1602 7.04634 10.7135L6.81967 10.5268C6.34634 10.1135 5.59301 10.0735 5.05967 10.4335L2.56634 12.1068C2.41967 11.7335 2.33301 11.3002 2.33301 10.7935V5.20683C2.33301 3.32683 3.32634 2.3335 5.20634 2.3335H10.793C12.673 2.3335 13.6663 3.32683 13.6663 5.20683V8.40683L13.5797 8.3335Z"
                                                fill="#0056B1" />
                                        </svg>
                                    </span>
                                    Hình ảnh <i>(Tối thiểu không quá 2mb)</i>
                                </div>
                                <div class="w-100 card-img">
                                    <div class="box-img">
                                        <img :src="image" />
                                    </div>

                                    <div class="">
                                        <!-- <input type="file" hidden v-model="file" ref="file-input" id="file-default" /> -->
                                        <b-form-file v-model="file"  @change="handleFileChange" hidden ref="file-input" class="d-none" id="file-default"></b-form-file>
                                        <div @click="delete_img" class="mb-3 btn-banner-delete" v-b-tooltip.hover title="Xoá ảnh">
                                            <svg width="33" height="32" viewBox="0 0 33 32" fill="none"
                                                xmlns="http://www.w3.org/2000/svg">
                                                <circle cx="16.5" cy="16" r="16" fill="#F2F2F2" />
                                                <g clip-path="url(#clip0_678_8713)">
                                                    <path
                                                        d="M16.5639 11.1532C18.6966 11.1532 20.8323 11.1592 22.9651 11.1473C23.2971 11.1473 23.4227 11.18 23.3779 11.5787C23.1266 13.8489 22.8634 16.122 22.7108 18.4011C22.6241 19.6894 22.5194 20.9717 22.4147 22.2571C22.3549 22.9949 22.2921 23.4799 22.1604 24.2059C21.9899 25.1342 21.6071 26 20.255 25.9881C17.7813 25.9911 15.3076 25.9643 12.8368 26C11.8198 26.0149 11.0152 25.8036 10.7789 24.2059C10.5127 22.4118 9.94433 14.1018 9.94433 14.1018L9.71699 11.7156C9.71699 11.7156 9.65418 11.1532 10.2076 11.1532C12.3283 11.1532 14.4461 11.1532 16.5669 11.1532H16.5639ZM17.0784 18.5498C17.0784 17.2734 17.0784 15.997 17.0784 14.7206C17.0784 14.2981 16.863 14.0303 16.528 14.0214C16.1541 14.0125 15.8849 14.3071 15.8849 14.7385C15.8849 17.2764 15.8849 19.8143 15.8879 22.3553C15.8879 22.8045 16.1361 23.105 16.4981 23.1169C16.8361 23.1288 17.0724 22.8105 17.0724 22.3374C17.0724 21.0759 17.0724 19.8114 17.0724 18.5498H17.0784ZM19.9649 18.5409C19.9649 17.2496 19.9649 15.9554 19.9649 14.6641C19.9649 14.4975 19.9858 14.3309 19.8153 14.2118C19.6239 14.078 19.4444 13.9589 19.1961 14.069C18.8791 14.2089 18.7834 14.4528 18.7864 14.7801C18.7953 17.2943 18.7953 19.8114 18.8013 22.3255C18.8013 22.8015 19.0316 23.108 19.3816 23.111C19.7316 23.1169 19.9709 22.8015 19.9709 22.3374C19.9709 21.0729 19.9709 19.8084 19.9709 18.5439L19.9649 18.5409ZM14.1918 18.5707C14.1918 17.2526 14.1918 15.9345 14.1918 14.6165C14.1918 14.2178 14.0213 14.0303 13.6594 14.0244C13.3453 14.0184 13.0911 14.2684 13.0911 14.6165C13.0881 17.2377 13.0881 19.8619 13.0911 22.4832C13.0911 22.8581 13.3663 23.1407 13.6833 23.108C14.0513 23.0693 14.2038 22.87 14.1978 22.4862C14.1799 21.183 14.1918 19.8768 14.1918 18.5736V18.5707Z"
                                                        fill="#979797" />
                                                    <path
                                                        d="M16.4776 10.0552C14.2461 10.0552 12.0147 10.0552 9.78024 10.0552C9.08927 10.0552 8.5 9.51374 8.5 8.88C8.5 8.29089 9.08628 7.72856 9.75631 7.72261C11.0844 7.71071 12.4125 7.70773 13.7406 7.72856C14.1085 7.73451 14.2222 7.6393 14.2042 7.26144C14.1713 6.59795 14.7786 6.01479 15.4576 6.00883C16.1366 6.00288 16.8156 6.04454 17.4916 5.99991C18.2035 5.9523 18.8436 6.61282 18.7868 7.23764C18.7509 7.63633 18.9124 7.73154 19.2893 7.72559C20.5755 7.70773 21.8617 7.74939 23.145 7.71666C24.0094 7.69583 24.8081 8.3504 24.3833 9.40068C24.2308 9.78152 23.812 10.0493 23.2616 10.0493C21.099 10.0493 18.9393 10.0493 16.7767 10.0493C16.678 10.0493 16.5793 10.0493 16.4806 10.0493L16.4776 10.0552Z"
                                                        fill="#979797" />
                                                </g>
                                                <defs>
                                                    <clipPath id="clip0_678_8713">
                                                        <rect width="16" height="20" fill="white"
                                                            transform="translate(8.5 6)" />
                                                    </clipPath>
                                                </defs>
                                            </svg>
                                        </div>

                                        <label for="file-default" class="btn-banner-save d-block" v-b-tooltip.hover title="Tải ảnh lên">
                                            <svg width="33" height="32" viewBox="0 0 33 32" fill="none"
                                                xmlns="http://www.w3.org/2000/svg">
                                                <circle cx="16.5" cy="16" r="16" fill="#F2F2F2" />
                                                <path d="M10.5 11.3846L16.5 6M16.5 6L22.5 11.3846M16.5 6L16.5 13"
                                                    stroke="#979797" stroke-width="1.5" stroke-linecap="round"
                                                    stroke-linejoin="round" />
                                                <path fill-rule="evenodd" clip-rule="evenodd"
                                                    d="M15.5 15V18.9375C15.5 19.4898 15.9477 19.9375 16.5 19.9375C17.0523 19.9375 17.5 19.4898 17.5 18.9375V15H23.5C24.6046 15 25.5 15.8954 25.5 17V22C25.5 23.1046 24.6046 24 23.5 24H9.5C8.39543 24 7.5 23.1046 7.5 22V17C7.5 15.8954 8.39543 15 9.5 15H15.5Z"
                                                    fill="#979797" />
                                            </svg>
                                        </label>
                                    </div>
                                </div>
                            </b-form-group>
                        </div>

                        <div class="mt-7">
                            <form id="form" @submit="send_data">
                                <button-component typeBtn="submit">
                                    Lưu
                                </button-component>
                            </form>
                        </div>

                    </div>
                </v-col>

            </v-row>
        </div>
    </div>
</template>

<script>
import SUNEDITOR from 'suneditor'
import plugins from 'suneditor/src/plugins'
import 'suneditor/dist/css/suneditor.min.css'
import api from '@/store/axios'
import Swal from 'sweetalert2'
import toastr from 'toastr';

export default {
    layout: 'admin',
    data() {
        return {
            title: {
                name: 'Chỉnh sửa gói giáo cụ',
                previous: '/admin/materials'
            },
            code: null,
            so_luong_tong: null,
            so_luong_ton: null,
            ghi_chu: null,
            file: null,
            image: null,
            clearFiles() {
                this.$refs['file-input'].reset()
            }
        };
    },
    validate({ params }) {
        return /^\d+$/.test(params.id);
    },
    computed: {
        id() {
            return this.$route.params.id
        },
        token() {
            const storedUser = JSON.parse(localStorage.getItem('user'));
            return storedUser.auth_key
        }
    },
    methods: {
        delete_img() {
            this.image = null;
            this.file = null;
        },
        handleFileChange(event) {
            const img = event.target.files[0];
            this.file = img;
            if (img) {
                this.image = URL.createObjectURL(img);
            }
        },
        async load_data() {
            await api.get('giao-cu/chi-tiet?id=' + this.id, {
                'Content-Type': 'multipart/form-data',
                Authorization: 'Bearer ' + this.token
            }).then(res => {
                const user = res?.data?.data
                this.data = user
                this.code = user?.code
                this.so_luong_tong = user?.so_luong_tong
                this.so_luong_ton = user?.so_luong_ton
                this.ghi_chu = user?.ghi_chu
                this.file = user?.image
                this.image = user?.image
            })
        },
        async send_data(event) {
            event.preventDefault();
            const formData = new FormData()
            formData.append('id', this.id);
            formData.append('code', this.code )
            formData.append('so_luong_tong', this.so_luong_tong )
            formData.append('so_luong_ton', this.so_luong_ton )
            formData.append('ghi_chu', this.ghi_chu )
            formData.append('image', this.file )

            await api.post('giao-cu/sua', formData, {
                'Content-Type': 'multipart/form-data',
                Authorization: 'Bearer ' + this.token
            }).then(res => {
                if (res?.status == 200) {
                    toastr.success(res?.data?.message);
                    this.load_data()
                    this.$router.push(this.title.previous);
                }
            })
        },
    },
    mounted() {
        this.title.previous = '/admin/materials/detail/' + this.id
        this.$store.dispatch('title/set_title', this.title);
        this.load_data()
    },
    components: {}
}
</script>

<style lang="scss" scoped>
.btn-banner-save {
    transition: 0.3s;
    cursor: pointer;
    // &:hover {
    //     stroke: rgb(30, 161, 236);
    //     transform: scale(1.05);
    // }
}
.btn-banner-delete {
    cursor: pointer;
    transition: 0.3s;
    // &:hover {
    //     stroke: rgb(238, 50, 50);
    //     transform: scale(1.05);
    // }
}
.card-img {
    padding: 10px;
    border-radius: 10px;
    border: 1px solid #E5E5E5;
    background: #FFF;
    display: flex;
    justify-content: space-between;
}

.box-img {

    width: 104px;
    height: 72px;

    img {
        width: 100%;
        height: 100%;
        object-fit: cover;
    }
}

.materials {
    i {
        color: #2D2D2D;
        font-family: SVN-Gilroy;
        font-size: 14px;
        font-style: italic;
        font-weight: 400;
        line-height: normal;
        margin-left: 7px;
    }

    .label {
        color: #2D2D2D;
        font-family: SVN-Gilroy;
        font-size: 14px;
        font-style: normal;
        font-weight: 600;
        line-height: normal;
        display: flex;
        align-items: center;
        margin-bottom: 10px;
    }

    @media (max-width: 600px) {
        .btn-type {
            padding: 8px 25px;
            margin-right: 7px;
            margin-bottom: 7px;
        }
    }
}
</style>